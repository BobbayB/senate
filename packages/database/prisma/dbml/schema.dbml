//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table User {
  id String [pk]
  name String [unique, not null]
  email String [not null]
  voters Voter [not null]
  subscriptions Subscription [not null]
  notifications Notification [not null]
}

Table Voter {
  id String [pk]
  address String [unique, not null]
  refreshStatus RefreshStatus [not null]
  lastRefresh DateTime [not null]
  users User [not null]
  votes Vote [not null]
}

Table DAO {
  id String [pk]
  name String [unique, not null]
  picture String [not null]
  refreshStatus RefreshStatus [not null]
  lastRefresh DateTime [not null]
  handlers DAOHandler [not null]
  proposals Proposal [not null]
  subscriptions Subscription [not null]
  votes Vote [not null]
}

Table DAOHandler {
  id String [pk]
  type DAOHandlerType [not null]
  decoder Json [not null]
  daoId String [not null]
  dao DAO [not null]

  indexes {
    (daoId, type) [unique]
  }
}

Table Proposal {
  id String [pk]
  externalId String [unique, not null]
  name String [not null]
  daoId String [not null]
  daoHandlerId String [not null]
  proposalType ProposalType [not null]
  data Json [not null]
  timeCreated DateTime [not null]
  timeStart DateTime [not null]
  timeEnd DateTime [not null]
  url String [not null]
  dao DAO [not null]
  votes Vote [not null]
  notifications Notification [not null]
  addedAt BigInt [not null]

  indexes {
    (externalId, daoId) [unique]
  }
}

Table Notification {
  id String [pk]
  user User [not null]
  userId String [not null]
  proposal Proposal [not null]
  proposalId String [not null]
  type RoundupNotificationType [not null]

  indexes {
    (proposalId, userId, type) [unique]
  }
}

Table Vote {
  id String [pk]
  voterAddress String [not null]
  proposalId String [not null]
  daoId String [not null]
  daoHandlerId String [not null]
  dao DAO [not null]
  proposal Proposal [not null]
  voter Voter [not null]
  options VoteOption [not null]
  addedAt BigInt [not null]

  indexes {
    (voterAddress, daoId, proposalId) [unique]
  }
}

Table VoteOption {
  id String [pk]
  option String [not null]
  optionName String [not null]
  voterAddress String [not null]
  voteDaoId String [not null]
  voteProposalId String [not null]
  vote Vote [not null]

  indexes {
    (voteProposalId, option) [unique]
  }
}

Table VoterLatestVoteBlock {
  id String [pk]
  voterAddress String [not null]
  daoHandlerId String [not null]
  latestVoteBlock Int [not null]

  indexes {
    (voterAddress, daoHandlerId) [unique]
  }
}

Table Subscription {
  id String [pk]
  userId String [not null]
  daoId String [not null]
  dao DAO [not null]
  user User [not null]

  indexes {
    (userId, daoId) [unique]
  }
}

Table UserToVoter {
  votersId String [ref: > Voter.id]
  usersId String [ref: > User.id]
}

Enum RoundupNotificationType {
  NEW
  ENDING_SOON
  VOTED
}

Enum DAOHandlerType {
  BRAVO1
  BRAVO2
  MAKER_EXECUTIVE
  MAKER_POLL_CREATE
  MAKER_POLL_VOTE
  SNAPSHOT
}

Enum ProposalType {
  BRAVO
  MAKER_EXECUTIVE
  MAKER_POLL
  SNAPSHOT
}

Enum RefreshStatus {
  NEW
  PENDING
  DONE
}

Ref: DAOHandler.daoId > DAO.id [delete: Cascade]

Ref: Proposal.daoId > DAO.id [delete: Cascade]

Ref: Notification.userId > User.id [delete: Cascade]

Ref: Notification.proposalId > Proposal.id [delete: Cascade]

Ref: Vote.daoId > DAO.id [delete: Cascade]

Ref: Vote.proposalId > Proposal.id [delete: Cascade]

Ref: Vote.voterAddress > Voter.address [delete: Cascade]

Ref: VoteOption.(voterAddress, voteDaoId, voteProposalId) > Vote.(voterAddress, daoId, proposalId) [delete: Cascade]

Ref: Subscription.daoId > DAO.id [delete: Cascade]

Ref: Subscription.userId > User.id [delete: Cascade]