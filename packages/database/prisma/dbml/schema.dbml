//// ------------------------------------------------------
//// THIS FILE WAS AUTOMATICALLY GENERATED (DO NOT MODIFY)
//// ------------------------------------------------------

Table User {
  id String [pk]
  address String [unique, not null]
  proxies UserProxy [not null]
  subscriptions Subscription [not null]
}

Table UserProxy {
  id String [pk]
  address String [not null]
  user User [not null]
  userId String [not null]
}

Table DAO {
  id String [pk]
  name String [unique, not null]
  picture String [not null]
  handlers DAOHandler [not null]
  subscriptions Subscription [not null]
  proposals Proposal [not null]
  votes Vote [not null]
}

Table DAOHandler {
  id String [pk]
  type DAOHandlerType [not null]
  decoder Json [not null]
  dao DAO [not null]
  daoId String [not null]

  indexes {
    (daoId, type) [unique]
  }
}

Table Proposal {
  id String [pk]
  externalId String [unique, not null]
  name String [not null]
  dao DAO [not null]
  daoId String [not null]
  daoHandlerId String [not null]
  proposalType ProposalType [not null]
  votes Vote [not null]
  data Json [not null]
  url String [not null]

  indexes {
    (externalId, daoId) [unique]
  }
}

Table Vote {
  id String [pk]
  options VoteOption [not null]
  voterAddress String [not null]
  proposal Proposal [not null]
  proposalId String [not null]
  dao DAO [not null]
  daoId String [not null]
  daoHandlerId String [not null]

  indexes {
    (voterAddress, daoId, proposalId) [unique]
  }
}

Table VoteOption {
  id String [pk]
  option String [not null]
  optionName String [not null]
  vote Vote [not null]
  voterAddress String [not null]
  voteDaoId String [not null]
  voteProposalId String [not null]

  indexes {
    (voteProposalId, option) [unique]
  }
}

Table VoterLatestVoteBlock {
  id String [pk]
  voterAddress String [not null]
  daoHandlerId String [not null]
  latestVoteBlock Int [not null]

  indexes {
    (voterAddress, daoHandlerId) [unique]
  }
}

Table Subscription {
  id String [pk]
  user User [not null]
  dao DAO [not null]
  userId String [not null]
  daoId String [not null]

  indexes {
    (userId, daoId) [unique]
  }
}

Table DAORefreshQueue {
  id String [pk]
  daoId String [not null]
  status RefreshStatus [not null]
  updatedAt DateTime [not null]
}

Table UsersRefreshQueue {
  id String [pk]
  userId String [not null]
  status RefreshStatus [not null]
  updatedAt DateTime [not null]
}

Enum DAOHandlerType {
  BRAVO1
  BRAVO2
  MAKER_EXECUTIVE
  MAKER_POLL_CREATE
  MAKER_POLL_VOTE
  SNAPSHOT
}

Enum ProposalType {
  BRAVO
  MAKER_EXECUTIVE
  MAKER_POLL
  SNAPSHOT
}

Enum RefreshStatus {
  NEW
  PENDING
  DONE
}

Ref: UserProxy.userId > User.id

Ref: DAOHandler.daoId > DAO.id [delete: Cascade]

Ref: Proposal.daoId > DAO.id [delete: Cascade]

Ref: Vote.proposalId > Proposal.id [delete: Cascade]

Ref: Vote.daoId > DAO.id [delete: Cascade]

Ref: VoteOption.(voterAddress, voteDaoId, voteProposalId) > Vote.(voterAddress, daoId, proposalId) [delete: Cascade]

Ref: Subscription.userId > User.id [delete: Cascade]

Ref: Subscription.daoId > DAO.id [delete: Cascade]